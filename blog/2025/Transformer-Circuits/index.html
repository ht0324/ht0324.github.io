<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Transformer Circuits(Anthropic) - Review | Hun Tae Kim</title> <meta name="author" content="Hun Tae Kim"> <meta name="description" content="Exploring the mathematical framework behind Transformer models"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Sans+3:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400;1,600&amp;family=Source+Serif+4:ital,opsz,wght@0,8..60,400;0,8..60,500;0,8..60,600;0,8..60,700;1,8..60,400;1,8..60,600&amp;display=swap"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%9A%80&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://ht0324.github.io/blog/2025/Transformer-Circuits/"> <link type="application/atom+xml" rel="alternate" href="https://ht0324.github.io/feed.xml" title="blank"> </head> <body class="fixed-top-nav " style="overflow-x: hidden; max-width: 100vw;"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title" href="/">Hun Tae Kim</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/Links/">Links</a> </li> <li class="nav-item "> <a class="nav-link" href="/CV/">CV</a> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" style="overflow-x: hidden;"> <div class="post"> <header class="post-header"> <h1 class="post-title">Transformer Circuits(Anthropic) - Review</h1> <div class="post-meta-wrapper"> <span> <i class="fas fa-calendar fa-sm"></i> January 13, 2025 </span> </div> <div class="post-tag-wrapper"> <a href="/blog/tag/ai" class="tag-pill"> <i class="fas fa-hashtag fa-sm"></i> AI</a> <a href="/blog/category/paper" class="tag-pill"> <i class="fas fa-folder fa-sm"></i> Paper</a> </div> </header> <article class="post-content"> <div id="markdown-content"> <p>This post reviews the paper “<a href="https://transformer-circuits.pub/2021/framework/index.html" rel="external nofollow noopener" target="_blank">A Mathematical Framework for Transformer Circuits</a>” by Anthropic. The authors take a clear, step-by-step approach to understanding how attention heads work in simplified transformer models, focusing especially on how the internal mechanics of these models can be mathematically described and interpreted. It’s a dense paper but an insightful one; I picked up a few high‑level ideas I hadn’t seen before.</p> <hr> <h3 id="key-concepts">Key Concepts</h3> <p><strong>1. Attention Heads as Independent Operations</strong><br> Attention heads are usually presented as concatenating their outputs and then multiplying by a large projection matrix (<code class="language-plaintext highlighter-rouge">W_O</code>). However, the authors emphasize a more intuitive (though mathematically equivalent) interpretation: attention heads independently compute results and add them directly to the residual stream. This simpler view helps clarify how a single head behaves, even as the implementation stays efficient via concatenation.</p> <p><strong>2. Residual Stream as a Communication Channel</strong><br> The residual stream is a shared space where layers communicate intermediate results. Each attention or MLP layer can both “read” from and “write” into it, allowing layers to build increasingly sophisticated and context-aware representations. This means the residual stream carries information about token meanings, syntactic roles, semantic relationships, and intermediate predictions — a shared whiteboard among specialists.</p> <p><strong>3. Virtual Weights and Composing Layers</strong><br> Each transformer layer performs linear transformations on the residual stream. When layers interact, these transformations can be multiplied out, forming “virtual weights,” which directly connect non-adjacent layers. Instead of thinking of each layer independently, virtual weights represent the total combined transformation of several layers together, like composing several functions into a single step.</p> <p><strong>4. QK and OV Circuits: “Which” vs. “What”</strong><br> Attention heads split their tasks clearly into two components:</p> <ul> <li> <strong>QK circuit (Query-Key)</strong> decides <strong>which</strong> tokens to pay attention to.</li> <li> <strong>OV circuit (Output-Value)</strong> decides <strong>what</strong> information from the selected tokens should be communicated.</li> </ul> <p>Separating these operations makes attention modular, allowing heads to specialize. It’s like a mail delivery system where route-planning (QK) is separate from package-handling (OV).</p> <p><strong>5. Skip-Trigrams in One-Layer Transformers</strong><br> A one-layer transformer (attention-only) can model relationships called skip-trigrams, patterns of the form “A… B C.” The QK circuit identifies the earlier token (A), while the OV circuit determines how it affects the likelihood of a later token (C), given the current context (B). It shows the transformer’s ability to capture context across short sequences effectively.</p> <p><strong>6. Copying and Primitive In-Context Learning</strong><br> One-layer attention heads often learn simple copying behavior: predicting a token identical to or closely related to an earlier one. Although basic, this copying behavior represents a primitive form of in-context learning, as the model uses context to influence predictions. It’s limited but forms the foundational mechanism upon which more advanced contextual adaptation is built.</p> <p><strong>7. Induction Heads and Advanced In-Context Learning</strong><br> Two-layer transformers introduce <strong>induction heads</strong>, a more advanced mechanism for in-context learning:</p> <ul> <li>They look back in the sequence for previous occurrences of the current token.</li> <li>They then predict the token that historically followed that occurrence.</li> </ul> <p>Compared to simple copying, induction heads understand sequences and contexts better, allowing them to adapt predictions more robustly, even in completely random sequences. This mechanism relies heavily on <strong>K-composition</strong>, meaning the second layer attention head uses information from a first-layer head that attends to an earlier token. This effectively shifts attention back one token, making complex pattern matching possible.</p> <hr> <h3 id="key-takeaways-what-i-learned">Key Takeaways (What I Learned)</h3> <p><strong>A Clearer Mental Model of Attention Heads</strong><br> Previously, I viewed attention heads as opaque, intertwined mechanisms. Now, clearly separating QK (attention pattern) from OV (content selection) circuits provides a cleaner and more intuitive mental model. It makes interpreting attention heads simpler, since I can independently analyze “where the model is looking” and “what information it is moving.”</p> <p><strong>Virtual Weights as a Useful Conceptual Tool</strong><br> The concept of virtual weights—where interactions between distant layers are explicitly multiplied out into direct connections—was a real “aha” moment. Instead of considering each layer in isolation, understanding their combined effect simplifies interpretation and clarifies how layers collaborate to build richer representations.</p> <p><strong>Understanding Primitive In-Context Learning (Copying)</strong><br> Initially, I was skeptical about calling simple copying “in-context learning.” However, after reflection, I realized copying does constitute a basic form of adapting predictions based on context, even if the adaptation is trivial. This simple mechanism sets the stage for the more advanced in-context learning found in deeper transformers. Recognizing this helps me appreciate how complexity emerges incrementally.</p> <p><strong>Induction Heads: How Transformers Learn Repetition</strong><br> The mechanism of induction heads, especially the “shifting the key” idea via K‑composition, stood out clearly. Rather than relying solely on statistical likelihoods (as simpler copying does), induction heads effectively form sequence-based “rules” (“If you saw token A before, predict what followed A previously”). Seeing this happen even in random sequences made it clear that induction heads capture sequence structures, not just statistics.</p> <p><strong>Analyzing Transformers Through Eigenvectors</strong><br> I found the use of eigenvectors and eigenvalues to analyze OV circuits interesting. Eigenvectors show how the transformer clusters tokens that mutually reinforce each other’s probabilities (like groups of related words), while positive eigenvalues specifically highlight copying or self-amplifying behavior. Although this analysis isn’t perfect, it’s a useful tool to uncover meaningful structures inside the transformer’s enormous matrices.</p> <p><strong>Limits of Current Interpretability Approaches</strong><br> Finally, this paper clarified that while some parts of transformers are now interpretable (especially attention mechanisms and induction heads), the role of MLP layers and more complex interaction patterns remains a challenge. This work sets a clear baseline for interpretability, but fully understanding transformers still requires significant advances, especially in interpreting neuron-level behavior within MLP layers.</p> <hr> <h3 id="summary--final-thoughts">Summary &amp; Final Thoughts</h3> <p>The Transformer Circuits paper offers a clear mathematical framework for understanding simplified transformers. By explicitly separating the roles of attention heads, introducing concepts like virtual weights, and highlighting how induction heads enable sophisticated in-context learning, it makes transformer internals more transparent.</p> <p>While this approach significantly clarifies the mechanics behind simpler transformers, interpreting larger, realistic models remains challenging—especially MLP layers. Nonetheless, this framework offers solid building blocks for deeper understanding and a useful first step toward interpretable neural networks.</p> </div> </article><div id="giscus_thread" style="max-width: 800px; margin: 0 auto;"> <script>let giscusTheme=localStorage.getItem("theme"),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"ht0324/ht0324.github.io","data-repo-id":"","data-category":"Comments","data-category-id":"","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2025 Hun Tae Kim. All Rights Reserved. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-7ZMBS6JQKV"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-7ZMBS6JQKV");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>